---
title: "EDA"
output: github_document
---

# Clusterization of Customer Segments (Part I)

## Exploratory Data Analaysis (EDA) of the raw dataset

```{r}
packages <- readLines("requirements.txt")
lapply(packages, library, character.only = TRUE)
```

```{r}
raw<-read.csv(file = "D:/МО II/WalletUpCRM.csv")
raw<-data.frame(raw)
head(raw)
```

Reviewing the structure of the data

```{r}
dim(raw)
```

The dataset includes data for 10 750 customers and their multiple characteristics, which we will use for the clusterization.

```{r}
str(raw)
```

The data is all numeric. Every column is in the right data type. Some attribbutes like income or mortgage are usually decimal numbers, but for this project they will be analyzed as integers as we do not have further specific information

```{r}
summary(raw)
```

The above shown code provides general exploratory summary of the raw dataset. By these general statistics, I can overview the mean values and the distribution of each column.

### Check for NULL values

```{r}
any(is.null(raw))
```

Check by each column

```{r}
sapply(raw, function(x) any(is.null(x)))
```

There are no missing values in the dataset, which assists in quicker EDA, clustering validation and modelling in the next steps.

###Correlation analysis

```{r}
datasummary_correlation(raw, fmt = 2, title = "Correlation Matrix")
```

There is a strong positive correlation between Grocery Spending x Income (0.9). Logically, a strong positive correlation with a coefficient of 0.92 can also be observed between Stock Volume x NasdaqInvest. Investments made in Bitcoin and NFT are correlated with a coefficient of 0.8, which may indicate that similar types of financial assets are preferred by one type of customer. However, strong or weak correlation coefficients do not equal causation between the analysed characteristics. This is another reason why we want to build the clustering model based on only behavioral attributes and ignore demographics like age and income. The customers' behaviour can hide interesting insights or segments, which can not be observed with simple EDA or correlation analysis.

### Distribution of customers based on age and other attributes

In the following code chunk, I built multiple visualizations in order to compare customers once they are divided in age groups. First I had to create the age bins, after that I inserted 4 bar charts.

```{r}
data_age_bins <- raw %>%
  mutate(age_group = case_when(
    Age <= 26 ~ "18-26",
    Age <= 34 ~ "26-34",
    Age <= 41 ~ "33-41",
    Age <= 49 ~ "41-49",
    Age <= 56 ~ "48-56",
    Age <= 63 ~ "56-63",
    Age >= 64 ~ "Over 64"
  ))
head(data_age_bins$age_group)
# Count of people in each age bin.
ggplot(data_age_bins, aes(x = age_group)) +
  geom_bar(fill = "skyblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Distribution of Age Groups", x = "Age Group", y = "Count")
# We have the most customers in the youngest age group, 18-25, with nearly 4,000 people. Then there are those aged 56-63 with about 1,600. And the fewest are pensioners over 64.

# Age Group x Income
ggplot(data_age_bins, aes(x = age_group, y=Income)) +
  geom_col(fill = "skyblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Distribution of Income", x = "Age Group", y = "Income") +
  scale_y_continuous(labels = function(x) format(round(x), big.mark = ",", scientific = FALSE))
# The two groups 26 - 34 and 56 - 63 have the highest income, exceeding $200,000. People in the middle age group from 40 to 55 years old, as well as retirees, have lower incomes.

# Age Group x Mortgage Volume
ggplot(data_age_bins, aes(x = age_group, y= MortageVolume)) +
  geom_col(fill = "skyblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Distribution of Mortgage", x = "Age Group", y = "Mortgage")+
  scale_y_continuous(labels = function(x) format(round(x), big.mark = ",", scientific = FALSE))
# Young adults between 26 and 34 have the highest mortgage debt at over $800,000,000 in total value.

# Age Group x ATM Transactions
ggplot(data_age_bins, aes(x = age_group, y= ATMVisits)) +
  geom_col(fill = "skyblue", color = "darkblue") +
  theme_minimal() +
  labs(title = "Distribution of ATM Visits", x = "Age Group", y = "ATM Visits")+
  scale_y_continuous(labels = function(x) format(round(x), big.mark = ",", scientific = FALSE))
# From this last graph, we can conclude that young customers most often use ATMs to withdraw cash.
```

### Outliers detection

Even though I work with clean dataset, it is still very important to check for outliers in the data. These are too high or low values based on the interquartile range of the attribute. I picked the reviewed attributes on random choice. The detection of outliers is crucial, because if there are identified ones, eventually the final ML clustering model should be picked with such consideration. I used boxplots to quickly review.

```{r}
boxplot(raw$MortageVolume, ylab = "Mortgage")
boxplot(raw$AccountSpending, ylab= "AccountSpending")
boxplot(raw$GrocerySpending, ylab= "GrocerySpending")
boxplot(raw$USAXSFundInvest, ylab= "USAXS Fund Invest")
boxplot(raw$ServiceFees, ylab= "ServiceFees")
```

In the dataset containing the behavioral characteristics of customers, anomalies can be found in some variables. If this data is not removed, but kept in order to preserve the information, then it is good to choose a clustering model, which copes better with the treatment of anomalies. For example, k-means is quite sensitive to outliers and it is possible that K-medoids is more suitable.

In the next notebooks, the project will continue in preparing the data for model building, validation of cluster formation and optimal number of k-clusters. Once I find this information, the testing between different models can initiate. Each model will be valuated with specific metrics. In the end, we will analyze the clustered dataset and present the customer segments.
